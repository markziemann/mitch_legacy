# nDrichr Report

```{r,echo=FALSE}
date()
```

## Background

nDrich performs multidimensional gene set enrichment analysis. The concept behind this dates to work by Cox and 
Mann (https://doi.org/10.1186/1471-2105-13-S16-S12). This implementation is suited to R based workflows of 
multi-omics datasets. This software was developed by Antony Kaspi and Mark Ziemann.

## Input profiles

Here is the first few lines of the input profile.

```{r,echo=FALSE}
load(DATANAME)
head(x)
```

Here are some metrics about the input data profile:

```{r,echo=FALSE}
  unformatted<-t(as.data.frame(res$manova_analysis_metrics[ c(2,3,4,5,11,12 ) ])) 
  formatted<-unformatted
  formatted[1:4]<-as.character(round(as.numeric(unformatted[1:4]) , digits=0))
  formatted[5:6]<-as.character(round(as.numeric(unformatted[5:6]) , digits=5))
  colnames(formatted)="Profile metrics"
  kable( formatted, caption = "Profile metrics" )

```

Here is the contour plot of the profile including all genes.

```{r,echo=FALSE}
  palette <- colorRampPalette(c("white", "yellow","orange" ,"red","darkred","black"))

  #Contour of all the data
  ss<-res$ranked_profile

  xmin=min(ss[,1])
  xmax=max(ss[,1])
  ymin=min(ss[,2])
  ymax=max(ss[,2])

  k<-MASS:::kde2d(ss[,1],ss[,2])
  X_AXIS=paste("Rank in contrast",colnames(ss)[1])
  Y_AXIS=paste("Rank in contrast",colnames(ss)[2])
  filled.contour(k, xlim=c(xmin,xmax),ylim=c(ymin,ymax),
    color=palette ,
    plot.title={ abline(v=0,h=0,lty=2,lwd=2,col="blue")
       title( main="Rank-rank plot of all genes",xlab=X_AXIS,ylab=Y_AXIS )
    }
  )

```

## Input genesets
Here are some metrics about the gene sets used:

```{r,results="asis",echo=FALSE}
  unformatted<-t(as.data.frame(res$manova_analysis_metrics[ c(1,6,7,13,14  ) ]))
  formatted<-as.data.frame(as.character( unformatted[1:5]) )
  rownames(formatted)=rownames(unformatted)
  colnames(formatted)="Gene sets metrics"
  kable( formatted , col.names = "Gene sets metrics" ,caption = "Gene sets metrics" )
```
Quadrant order is top-right, bottom-right, bottom-left and top-left.

More about the sizes of the gene sets evaluated.

```{r,results="asis",echo=FALSE}
  par(mfrow=c(3,1))
  geneset_counts<-res$manova_analysis_metrics$geneset_counts
  boxplot(geneset_counts[,2],horizontal=T,frame=F,main="Gene set size",xlab="number of member genes included in profile")
  hist(geneset_counts$count,100,xlab="geneset size",main="Histogram of geneset size")
  hist(geneset_counts$count,100,xlim=c(0,500),xlab="geneset size",main="Trimmed histogram of geneset size")

```


By default, R will print the command that you entered and below that the output with comment characters preceeding it.

# Controlling chunk evaluation / printing / etc

There are three related options for controlling what gets evaluated and printed from a code chunk.

* `results`: This can be set to `"markup"` (the default) or `"hide"` to supress output.  Note the quotes!  There is another option `"asis"` that turns out to be useful sometimes, but only when you're _generating_ Markdown with your R code.
* `echo`: When this is `TRUE` (the default), your code will be included in the output document.  When `FALSE`, your code will not be printed.
* `eval`: This is `TRUE` by default, and indicates if code should be run.  It may still be printed (based on `echo`) but the value of `results` will not matter because it won't generate any output.

This block of code will run, but leave no trace of its running in the final document:
```{r,results="hide",echo=FALSE}
a <- 1
```

This code will not run, but allows you to include a block of R text in the final document (with pretty syntax highlighting):
```{r,eval=FALSE}
f <- function(x) {
  # code would go here...
}
```

This code will run, but only show the output:
```{r,echo=FALSE}
matrix(runif(20), 4, 5) # matrix of random numbers
```

This code will run, but show only the input:
```{r,results="hide"}
b <- a + 1
```

# Inserting figures

You can insert figures just like normal code blocks:
```{r}
plot(1:10)
```

There are more options though: the `fig.width` and `fig.height` control the sizes:

```{r,fig.width=6,fig.height=4}
plot(1:10)
```

Sometimes when you're making figures you'll want to hide the actual R code used to generate it; use `echo=FALSE` as above.

```{r,echo=FALSE}
plot(1:10)
```

# A slightly more realistic example

```{r,echo=FALSE}
# This block is hidden because it's ugly - generate a data set
n <- 40
set.seed(1)
x <- runif(n)
g <- sample(2, n, replace=TRUE)
y <- rnorm(n, x) + g
d <- data.frame(x, y, group=g)
rm(n, x, y, g)
```

Here is my data set
```{r}
head(d)
```

Fit a simple linear model:

```{r}
fit <- lm(y ~ x + group, d)
```

Both of the factors are significant:
```{r}
anova(fit)
```

The estimated slope of `y` on `x` is `r coef(fit)["x"]`.  The full coefficient list and their errors is

```{r}
summary(fit)
```


Look at the residuals/fitted diagnostic plot:

```{r}
plot(fit, 1)
```



# Other markdown tricks

## Tables

Tables are not much fun to make.  There is a markdown mode:

Fruit | Cost
------|-----
Apple | $1.20
Pear  | $2.10

but it's fiddly to deal with.

## Links

To make a link, you put the text you want to appear within square brackets, and the target of the link in parentheses.  For example here is a link to [our website](http://nicercode.github.io).

## Images

To include an image (not one of your R figures), the code looks like `![alt text](uri)`, where `"alt text"` is the text that will be included for people who can't see the image (and the hover-over text in some browsers), and the `uri` can be a relative link to a file on your computer or a full url (i.e., begining with `http://`).  For example:

![some kittens](http://placekitten.com/g/600/200)

Using the results option to generate images

```{r,results="asis",echo=FALSE}
writeLines(sprintf("![some kittens](http://placekitten.com/g/%d00/100)  ", 1:6))
```
